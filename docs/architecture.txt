StaticAspect "CareTogether V2" { 
  AppClient SupportClient AnalyticsClient IntegrationClient
  MembershipManager ProcessManager CommunicationManager
  EvaluationEngine
  AccountsAccess PoliciesAccess WorkflowsAccess RecordsAccess 
  AccountsResource PoliciesResource WorkflowsResource RecordsResource FormsResource
  EventLogUtility
  FileStoreUtility
  ObjectStoreUtility
  TelephonyUtility
  EmailUtility
  PushNotificationUtility
  PubSubUtility
  SecurityUtility
  LoggingUtility
}

/*
# MIGRATION NOTES
- Authorize*CommandAsync methods move into the Resource Access layer (primarily into RecordsAccess)
*/

Activity "UC-Me-1: Sign In" {
  |u|User
  |s|System
  |u|
  start
  :Browse to CareTogether;
  if (User signed in) is (no) then
    :Redirect to Sign-In Screen;
    |s|
    :Determine sign-in methods to offer;
    |u|
    :Select sign-in method;
    :Enter credentials;
    |s|
    :Load user account;
  else (yes)
  end if
  |u|
  :Open Dashboard;
  stop
}

/*
UseCase "UC-Me-1: Sign In - BROKEN" {
  AppClient - ClaimsPrincipal ISecurityUtility.Authenticate(HttpContext) > SecurityUtility
  AppClient - AppUserAccount IMembershipManager.SignIn(ClaimsPrincipal) > MembershipManager
  MembershipManager - Account IAccountsAccess.GetOrCreateUserAccount(ClaimsPrincipal) > AccountsAccess - Account IAccountsResource.GetOrCreateUserAccount(UserId) > AccountsResource
}
*/
UseCase "UC-Me-1: Sign In - WORKING" {
  AppClient - Response<AppUserAccount> IMembershipManager.SignIn(HttpContext) > MembershipManager
  MembershipManager - ClaimsPrincipal ISecurityUtility.Authenticate(HttpContext) > SecurityUtility
  MembershipManager - Response<Account> IAccountsAccess.GetOrCreateUserAccount(ClaimsPrincipal) > AccountsAccess
  AccountsAccess - Response<Account> IAccountsResource.GetOrCreateUserAccount(GetOrCreateUserAccountRequest) > AccountsResource
}

/* HttpContext DTO is provided by ASP.NET Core */
/* ClaimsPrincipal DTO is provided by System.Security.Claims */
/* Response<T> DTO will need to be defined in our internal standard library */

DTO AppUserAccount {
  Guid UserId
  /*TODO: Define this*/
}

DTO Account {
  Guid UserId
  AccountOrganizationAccess[] Organizations
}

DTO AccountOrganizationAccess {
  Guid OrganizationId
  AccountLocationAccess[] Locations
}

DTO AccountLocationAccess {
  Guid LocationId
  Guid PersonId
  string[] Roles
}

DTO GetOrCreateUserAccountRequest {
  Guid UserId
}

Activity "UC-Pr-1: Open Location" {
  |c|Client
  |s|System
  |c|
  start
  :Sign In
    ""<color:#777>[UC-Me-1]</color>"";
  :Select Organization;
  :Select Location;
  |s|
  :Authorize User Access in Context
    ""<color:#777>[SUB-Pr-1]</color>"";
  :Load Location Data; 
  'NOTE: This will also be the Process Manager
  |c|
  :View Location Dashboard;
  stop
}

UseCase "UC-Pr-1: Open Location" {
  AppClient -> ProcessManager
  ProcessManager -> EvaluationEngine

}

UseCase "SUB-Pr-1: Authorize User Access in Context" {
  ProcessManager - ContextPermissions IEvaluationEngine.AuthorizeUserAccess(AuthorizationContext) > EvaluationEngine
  EvaluationEngine -> AccountsAccess -> AccountsResource
  EvaluationEngine -> PoliciesAccess -> PoliciesResource
  EvaluationEngine -> RecordsAccess -> RecordsResource
}

DTO AuthorizationContext {}

/*BUG: DTO inheritance is not supported*/
/*DTO GlobalAuthorizationContext : AuthorizationContext {}*/

Activity "UC-Pr-2: View Communities List" {
  |c|Client
  |s|System
  |c|
  start
  :Open Location
    ""<color:#777>[UC-Pr-1]</color>"";
  :Select Communities Screen;
  |s|
  :List Communities for User;
  |c|
  :Display Communities List;
  stop
}

UseCase "UC-Pr-2: View Communities List in Location" {
  AppClient -> ProcessManager
  ProcessManager - Response<ContextualPermissions> IEvaluationEngine.CalculateContextualPermissions(LocationAuthorizationContext) > EvaluationEngine
  ProcessManager - Response<FilterCommunitiesResponse> IRecordsAccess.Filter(FilterCommunitiesAccessRequest) > RecordsAccess
  RecordsAccess - Response<FilterCommunitiesResponse> IRecordsResource.Filter(FilterCommunitiesResourceRequest) > RecordsResource
}

UseCase "UC-Pr-2: View Communities List in Organization" {
  AnalyticsClient -> ProcessManager
  SupportClient -> ProcessManager
  ProcessManager - Response<ContextualPermissions> IEvaluationEngine.AuthorizeUserAccess(OrganizationAuthorizationContext) > EvaluationEngine
  ProcessManager - Response<FilterCommunitiesResponse> IRecordsAccess.Filter(FilterCommunitiesAccessRequest) > RecordsAccess
  RecordsAccess - Response<FilterCommunitiesResponse> IRecordsResource.Filter(FilterCommunitiesResourceRequest) > RecordsResource
}

DTO ContextualPermissions {
  AuthorizationContext Context
  string[] Permissions
}

DTO Community {}

DTO FilterCommunitiesResponse {
  Community[] Communities
}

DTO FilterCommunitiesAccessRequest {
  ContextualPermissions Permissions
  Guid? OrganizationId
  Guid? LocationId
}

DTO FilterCommunitiesResourceRequest {
  Guid? OrganizationId
  Guid? LocationId
}

UseCase "Create Referral" {
  AppClient -> ProcessManager
  ProcessManager -> EvaluationEngine
  EvaluationEngine -> AccountsAccess -> AccountsResource
  EvaluationEngine -> PoliciesAccess -> PoliciesResource
  EvaluationEngine -> RecordsAccess -> RecordsResource
  ProcessManager -> RecordsAccess -> RecordsResource
}

/*
Activity "Create Campaign From Recommendation" {
  |c|Client
  |s|System
  |c|
  start
  :Select Recommendation (View Campaign Recommendation);
  while (Contacts satisfactory?) is (no)
    :Filter Eligible Contacts
    ""<color:#777>[UC-4]</color>"";
  endwhile (yes)
  :Click Create Campaign;
  |s|
  floating note: via webhook in **V0.1**
  :System: Create New Draft Campaign;
  |c|
  :View Draft Campaign (View Draft Campaign);
  stop
}*/

UseCase "View Communities List" {
@@@
### Prerequisites
- `ContextPermissions` for 'All Communities' context
@@@
  AppClient -> ProcessManager
  ProcessManager -> RecordsAccess -> RecordsResource
}

/* TODO: check */
UseCase "View Communities List V2" {
  AppClient -> ProcessManager
  ProcessManager -> RecordsAccess -> RecordsResource /* gets families */
  ProcessManager -> EvaluationEngine /* evaluate which families are visible */
  /* render combined family info */
  ProcessManager -> PoliciesAccess -> PoliciesResource
  ProcessManager -> RecordsAccess -> RecordsResource
  ProcessManager -> RecordsAccess -> RecordsResource /* render partnering family info */
  ProcessManager -> RecordsAccess -> RecordsResource /* render volunteer family info */
  ProcessManager -> EvaluationEngine -> PoliciesAccess -> PoliciesResource /* calculate approval status */
  ProcessManager -> RecordsAccess -> RecordsResource /* get notes */
  ProcessManager -> EvaluationEngine /* disclose family */
  /* end */
  ProcessManager -> RecordsAccess -> RecordsResource /* gets communities */
  ProcessManager -> EvaluationEngine /* evaluate which communities are visible */
  ProcessManager -> EvaluationEngine /* disclose communities */
}
 

UseCase "Track Child Location" {
  AppClient -> ProcessManager
  ProcessManager -> EvaluationEngine
  EvaluationEngine -> AccountsAccess -> AccountsResource
  EvaluationEngine -> RecordsAccess -> RecordsResource
  EvaluationEngine -> PoliciesAccess -> PoliciesResource
  ProcessManager -> RecordsAccess -> RecordsResource
}

UseCase "Create New Arrangement" {
  AppClient -> ProcessManager
  ProcessManager -> EvaluationEngine
  EvaluationEngine -> AccountsAccess -> AccountsResource
  EvaluationEngine -> RecordsAccess -> RecordsResource
  EvaluationEngine -> PoliciesAccess -> PoliciesResource
  ProcessManager -> RecordsAccess -> RecordsResource
}

UseCase "Create Family" {
  AppClient -> ProcessManager
  ProcessManager -> EvaluationEngine
  EvaluationEngine -> AccountsAccess -> AccountsResource
  EvaluationEngine -> RecordsAccess -> RecordsResource
  EvaluationEngine -> PoliciesAccess -> PoliciesResource
  ProcessManager -> RecordsAccess -> RecordsResource
}

UseCase "Delete Family" {
  AppClient -> ProcessManager
  ProcessManager -> EvaluationEngine
  EvaluationEngine -> AccountsAccess -> AccountsResource
  EvaluationEngine -> RecordsAccess -> RecordsResource
  EvaluationEngine -> PoliciesAccess -> PoliciesResource
  ProcessManager -> RecordsAccess -> RecordsResource
}

UseCase "Add Adult" {
  AppClient -> ProcessManager
  ProcessManager -> EvaluationEngine
  EvaluationEngine -> AccountsAccess -> AccountsResource
  EvaluationEngine -> RecordsAccess -> RecordsResource
  EvaluationEngine -> PoliciesAccess -> PoliciesResource
  ProcessManager -> RecordsAccess -> RecordsResource
}
UseCase "Add Child" {
  AppClient -> ProcessManager
  ProcessManager -> EvaluationEngine
  EvaluationEngine -> AccountsAccess -> AccountsResource
  EvaluationEngine -> RecordsAccess -> RecordsResource
  EvaluationEngine -> PoliciesAccess -> PoliciesResource
  ProcessManager -> RecordsAccess -> RecordsResource
}

UseCase "Delete Person" {
  AppClient -> ProcessManager
  ProcessManager -> EvaluationEngine
  EvaluationEngine -> AccountsAccess -> AccountsResource
  EvaluationEngine -> RecordsAccess -> RecordsResource
  EvaluationEngine -> PoliciesAccess -> PoliciesResource
  ProcessManager -> RecordsAccess -> RecordsResource
}

UseCase "Move Person to Another Family" {
  AppClient -> ProcessManager
  ProcessManager -> EvaluationEngine
  EvaluationEngine -> AccountsAccess -> AccountsResource
  EvaluationEngine -> RecordsAccess -> RecordsResource
  EvaluationEngine -> PoliciesAccess -> PoliciesResource
  ProcessManager -> RecordsAccess -> RecordsResource
}

UseCase "Read Family Documents" {
  AppClient -> ProcessManager
  ProcessManager -> EvaluationEngine
  EvaluationEngine -> AccountsAccess -> AccountsResource
  EvaluationEngine -> RecordsAccess -> RecordsResource
  EvaluationEngine -> PoliciesAccess -> PoliciesResource
  ProcessManager -> RecordsAccess -> RecordsResource
}

UseCase "Upload Family Documents" {
  AppClient -> ProcessManager
  ProcessManager -> EvaluationEngine
  EvaluationEngine -> AccountsAccess -> AccountsResource
  EvaluationEngine -> RecordsAccess -> RecordsResource
  EvaluationEngine -> PoliciesAccess -> PoliciesResource
  ProcessManager -> RecordsAccess -> RecordsResource
}

UseCase "Archive Family Documents" {
  AppClient -> ProcessManager
  ProcessManager -> EvaluationEngine
  EvaluationEngine -> AccountsAccess -> AccountsResource
  EvaluationEngine -> RecordsAccess -> RecordsResource
  EvaluationEngine -> PoliciesAccess -> PoliciesResource
  ProcessManager -> RecordsAccess -> RecordsResource
}

UseCase "View Family Document Metadata" {
  AppClient -> ProcessManager
  ProcessManager -> EvaluationEngine
  EvaluationEngine -> AccountsAccess -> AccountsResource
  EvaluationEngine -> RecordsAccess -> RecordsResource
  EvaluationEngine -> PoliciesAccess -> PoliciesResource
  ProcessManager -> RecordsAccess -> RecordsResource
}

/* TODO: check */
UseCase "Invite Person User" {
  AppClient -> MembershipManager
  MembershipManager -> EvaluationEngine
  EvaluationEngine -> AccountsAccess -> AccountsResource
  EvaluationEngine -> RecordsAccess -> RecordsResource
  EvaluationEngine -> PoliciesAccess -> PoliciesResource
  MembershipManager -> AccountsAccess -> AccountsResource
}

/* TODO: account or records? */
UseCase "Edit Person User Protected Roles" {
  AppClient -> MembershipManager
  MembershipManager -> EvaluationEngine
  EvaluationEngine -> AccountsAccess -> AccountsResource
  EvaluationEngine -> RecordsAccess -> RecordsResource
  EvaluationEngine -> PoliciesAccess -> PoliciesResource
  MembershipManager -> RecordsAccess -> RecordsResource
  MembershipManager -> AccountsAccess -> AccountsResource
}

/* TODO: check */
UseCase "Edit Person User Standard Roles" {
  AppClient -> MembershipManager
  MembershipManager -> EvaluationEngine
  EvaluationEngine -> AccountsAccess -> AccountsResource
  EvaluationEngine -> RecordsAccess -> RecordsResource
  EvaluationEngine -> PoliciesAccess -> PoliciesResource
  MembershipManager -> RecordsAccess -> RecordsResource
  MembershipManager -> AccountsAccess -> AccountsResource
}

/* TODO: check */
UseCase "View Person User Login Info" {
  AppClient -> MembershipManager
  MembershipManager -> AccountsAccess -> AccountsResource
  MembershipManager -> RecordsAccess -> RecordsResource
  MembershipManager -> EvaluationEngine
  EvaluationEngine -> AccountsAccess -> AccountsResource
  EvaluationEngine -> RecordsAccess -> RecordsResource
  EvaluationEngine -> PoliciesAccess -> PoliciesResource
  MembershipManager -> IdentityProviderUtility
}

/* TODO: check */
UseCase "View Volunteers List" {
  AppClient -> ProcessManager
  ProcessManager -> EvaluationEngine
  EvaluationEngine -> AccountsAccess -> AccountsResource
  EvaluationEngine -> RecordsAccess -> RecordsResource
  EvaluationEngine -> PoliciesAccess -> PoliciesResource
  ProcessManager -> RecordsAccess -> RecordsResource
}

/* TODO: check */
UseCase "Access Partnering Families Screen" {
  AppClient -> ProcessManager
  ProcessManager -> EvaluationEngine
  EvaluationEngine -> AccountsAccess -> AccountsResource
  EvaluationEngine -> RecordsAccess -> RecordsResource
  EvaluationEngine -> PoliciesAccess -> PoliciesResource
  ProcessManager -> RecordsAccess -> RecordsResource
}

/* TODO: check */
UseCase "Access Settings Screen" {
  AppClient -> ProcessManager
  ProcessManager -> EvaluationEngine
  EvaluationEngine -> AccountsAccess -> AccountsResource
  EvaluationEngine -> RecordsAccess -> RecordsResource
  EvaluationEngine -> PoliciesAccess -> PoliciesResource
  ProcessManager -> RecordsAccess -> RecordsResource
}

/* TODO: check (this isn't implemented currently?) */
UseCase "Edit Roles" {
  AppClient -> MembershipManager
  MembershipManager -> AccountsAccess -> AccountsResource
  MembershipManager -> RecordsAccess -> RecordsResource
  MembershipManager -> EvaluationEngine
  EvaluationEngine -> AccountsAccess -> AccountsResource
  EvaluationEngine -> RecordsAccess -> RecordsResource
  EvaluationEngine -> PoliciesAccess -> PoliciesResource
  MembershipManager -> IdentityProviderUtility
}

/* TODO: check */
UseCase "View Communities List 0" {
  AppClient -> ProcessManager
  ProcessManager -> RecordsAccess -> RecordsResource /* gets families */
  ProcessManager -> EvaluationEngine /* evaluate which families are visible */
  /* render combined family info */
  ProcessManager -> PoliciesAccess -> PoliciesResource
  ProcessManager -> RecordsAccess -> RecordsResource
  ProcessManager -> RecordsAccess -> RecordsResource /* render partnering family info */
  ProcessManager -> RecordsAccess -> RecordsResource /* render volunteer family info */
  ProcessManager -> EvaluationEngine -> PoliciesAccess -> PoliciesResource /* calculate approval status */
  ProcessManager -> RecordsAccess -> RecordsResource /* get notes */
  ProcessManager -> EvaluationEngine /* disclose family */
  /* end */
  ProcessManager -> RecordsAccess -> RecordsResource /* gets communities */
  ProcessManager -> EvaluationEngine /* evaluate which communities are visible */
  ProcessManager -> EvaluationEngine /* disclose communities */
}

/* TODO: check */
UseCase "View Family Custom Fields" {
  AppClient -> ProcessManager
  ProcessManager -> EvaluationEngine
  EvaluationEngine -> AccountsAccess -> AccountsResource
  EvaluationEngine -> RecordsAccess -> RecordsResource
  EvaluationEngine -> PoliciesAccess -> PoliciesResource
  ProcessManager -> RecordsAccess -> RecordsResource
}

/* TODO: check */
UseCase "View Family History" {
  AppClient -> ProcessManager
  ProcessManager -> EvaluationEngine
  EvaluationEngine -> AccountsAccess -> AccountsResource
  EvaluationEngine -> RecordsAccess -> RecordsResource
  EvaluationEngine -> PoliciesAccess -> PoliciesResource
  ProcessManager -> RecordsAccess -> RecordsResource
}

/* TODO: check */
UseCase "View Person Concerns" {
  AppClient -> ProcessManager
  ProcessManager -> EvaluationEngine
  EvaluationEngine -> AccountsAccess -> AccountsResource
  EvaluationEngine -> RecordsAccess -> RecordsResource
  EvaluationEngine -> PoliciesAccess -> PoliciesResource
  ProcessManager -> RecordsAccess -> RecordsResource
}

/* TODO: check */
UseCase "View Person Notes" {
  AppClient -> ProcessManager
  ProcessManager -> EvaluationEngine
  EvaluationEngine -> AccountsAccess -> AccountsResource
  EvaluationEngine -> RecordsAccess -> RecordsResource
  EvaluationEngine -> PoliciesAccess -> PoliciesResource
  ProcessManager -> RecordsAccess -> RecordsResource
}

/* TODO: check */
UseCase "View Person Contact Info" {
  AppClient -> ProcessManager
  ProcessManager -> EvaluationEngine
  EvaluationEngine -> AccountsAccess -> AccountsResource
  EvaluationEngine -> RecordsAccess -> RecordsResource
  EvaluationEngine -> PoliciesAccess -> PoliciesResource
  ProcessManager -> RecordsAccess -> RecordsResource
}

/* TODO: check */
UseCase "Edit Family Info" {
  AppClient -> ProcessManager
  ProcessManager -> EvaluationEngine
  EvaluationEngine -> AccountsAccess -> AccountsResource
  EvaluationEngine -> RecordsAccess -> RecordsResource
  EvaluationEngine -> PoliciesAccess -> PoliciesResource
  ProcessManager -> RecordsAccess -> RecordsResource
}

/* TODO: check */
UseCase "Edit Person Concerns" {
  AppClient -> ProcessManager
  ProcessManager -> EvaluationEngine
  EvaluationEngine -> AccountsAccess -> AccountsResource
  EvaluationEngine -> RecordsAccess -> RecordsResource
  EvaluationEngine -> PoliciesAccess -> PoliciesResource
  ProcessManager -> RecordsAccess -> RecordsResource
}

/* TODO: check */
UseCase "Edit Person Notes" {
  AppClient -> ProcessManager
  ProcessManager -> EvaluationEngine
  EvaluationEngine -> AccountsAccess -> AccountsResource
  EvaluationEngine -> RecordsAccess -> RecordsResource
  EvaluationEngine -> PoliciesAccess -> PoliciesResource
  ProcessManager -> RecordsAccess -> RecordsResource
}

/* TODO: check */
UseCase "Edit Person Contact Info" {
  AppClient -> ProcessManager
  ProcessManager -> EvaluationEngine
  EvaluationEngine -> AccountsAccess -> AccountsResource
  EvaluationEngine -> RecordsAccess -> RecordsResource
  EvaluationEngine -> PoliciesAccess -> PoliciesResource
  ProcessManager -> RecordsAccess -> RecordsResource
}

/* TODO: check */
UseCase "Add / Edit Draft Notes" {
  AppClient -> ProcessManager
  ProcessManager -> EvaluationEngine
  EvaluationEngine -> AccountsAccess -> AccountsResource
  EvaluationEngine -> RecordsAccess -> RecordsResource
  EvaluationEngine -> PoliciesAccess -> PoliciesResource
  ProcessManager -> RecordsAccess -> RecordsResource
}

/* TODO: check */
UseCase "Discard Draft Notes" {
  AppClient -> ProcessManager
  ProcessManager -> EvaluationEngine
  EvaluationEngine -> AccountsAccess -> AccountsResource
  EvaluationEngine -> RecordsAccess -> RecordsResource
  EvaluationEngine -> PoliciesAccess -> PoliciesResource
  ProcessManager -> RecordsAccess -> RecordsResource
}

/* TODO: check */
UseCase "Approve Notes" {
  AppClient -> ProcessManager
  ProcessManager -> EvaluationEngine
  EvaluationEngine -> AccountsAccess -> AccountsResource
  EvaluationEngine -> RecordsAccess -> RecordsResource
  EvaluationEngine -> PoliciesAccess -> PoliciesResource
  ProcessManager -> RecordsAccess -> RecordsResource
}

/* TODO: check */
UseCase "View All Notes" {
  AppClient -> ProcessManager
  ProcessManager -> EvaluationEngine
  EvaluationEngine -> AccountsAccess -> AccountsResource
  EvaluationEngine -> RecordsAccess -> RecordsResource
  EvaluationEngine -> PoliciesAccess -> PoliciesResource
  ProcessManager -> RecordsAccess -> RecordsResource
}

/* TODO: check */
UseCase "View Approval Status" {  
  AppClient -> ProcessManager
  ProcessManager -> EvaluationEngine
  EvaluationEngine -> AccountsAccess -> AccountsResource
  EvaluationEngine -> RecordsAccess -> RecordsResource
  EvaluationEngine -> PoliciesAccess -> PoliciesResource
  ProcessManager -> RecordsAccess -> RecordsResource
}

/* TODO: check */
UseCase "Edit Approval Requirement Completion" {
  AppClient -> ProcessManager
  ProcessManager -> EvaluationEngine
  EvaluationEngine -> AccountsAccess -> AccountsResource
  EvaluationEngine -> RecordsAccess -> RecordsResource
  EvaluationEngine -> PoliciesAccess -> PoliciesResource
  ProcessManager -> RecordsAccess -> RecordsResource
}

/* TODO: check */
UseCase "Edit Approval Requirement Exemption" {
  AppClient -> ProcessManager
  ProcessManager -> EvaluationEngine
  EvaluationEngine -> AccountsAccess -> AccountsResource
  EvaluationEngine -> RecordsAccess -> RecordsResource
  EvaluationEngine -> PoliciesAccess -> PoliciesResource
  ProcessManager -> RecordsAccess -> RecordsResource
}

/* TODO: check */
UseCase "Edit Volunteer Role Participation" {
  AppClient -> ProcessManager
  ProcessManager -> EvaluationEngine
  EvaluationEngine -> AccountsAccess -> AccountsResource
  EvaluationEngine -> RecordsAccess -> RecordsResource
  EvaluationEngine -> PoliciesAccess -> PoliciesResource
  ProcessManager -> RecordsAccess -> RecordsResource
}

/* TODO: check */
UseCase "View Approval Progress" {
  AppClient -> ProcessManager
  ProcessManager -> EvaluationEngine
  EvaluationEngine -> AccountsAccess -> AccountsResource
  EvaluationEngine -> RecordsAccess -> RecordsResource
  EvaluationEngine -> PoliciesAccess -> PoliciesResource
  ProcessManager -> RecordsAccess -> RecordsResource
}

/* TODO: check */
UseCase "View Approval History" {
  AppClient -> ProcessManager
  ProcessManager -> EvaluationEngine
  EvaluationEngine -> AccountsAccess -> AccountsResource
  EvaluationEngine -> RecordsAccess -> RecordsResource
  EvaluationEngine -> PoliciesAccess -> PoliciesResource
  ProcessManager -> RecordsAccess -> RecordsResource
}

/* TODO: check */
UseCase "Activate Volunteer Family" {
  AppClient -> ProcessManager
  ProcessManager -> EvaluationEngine
  EvaluationEngine -> AccountsAccess -> AccountsResource
  EvaluationEngine -> RecordsAccess -> RecordsResource
  EvaluationEngine -> PoliciesAccess -> PoliciesResource
  ProcessManager -> RecordsAccess -> RecordsResource
}

/* TODO: check */
UseCase "Create Referral 0" {
  AppClient -> ProcessManager
  ProcessManager -> EvaluationEngine
  EvaluationEngine -> AccountsAccess -> AccountsResource
  EvaluationEngine -> RecordsAccess -> RecordsResource
  EvaluationEngine -> PoliciesAccess -> PoliciesResource
  ProcessManager -> WorkflowsAccess -> WorkflowsResource
  ProcessManager -> RecordsAccess -> RecordsResource
  ProcessManager -:q> CommunicationManager
}

/* TODO: check */
UseCase "Edit Referral" {
  AppClient -> ProcessManager
  ProcessManager -> EvaluationEngine
  EvaluationEngine -> AccountsAccess -> AccountsResource
  EvaluationEngine -> RecordsAccess -> RecordsResource
  EvaluationEngine -> PoliciesAccess -> PoliciesResource
  ProcessManager -> RecordsAccess -> RecordsResource
}

/* TODO: check */
UseCase "Close Referral" {
  AppClient -> ProcessManager
  ProcessManager -> EvaluationEngine
  EvaluationEngine -> AccountsAccess -> AccountsResource
  EvaluationEngine -> RecordsAccess -> RecordsResource
  EvaluationEngine -> PoliciesAccess -> PoliciesResource
  ProcessManager -> RecordsAccess -> RecordsResource
}

/* TODO: check */
UseCase "View Referral Custom Fields" {
  AppClient -> ProcessManager
  ProcessManager -> EvaluationEngine
  EvaluationEngine -> AccountsAccess -> AccountsResource
  EvaluationEngine -> RecordsAccess -> RecordsResource
  EvaluationEngine -> PoliciesAccess -> PoliciesResource
  ProcessManager -> RecordsAccess -> RecordsResource
}

/* TODO: check */
UseCase "View Referral Comments" {
  AppClient -> ProcessManager
  ProcessManager -> EvaluationEngine
  EvaluationEngine -> AccountsAccess -> AccountsResource
  EvaluationEngine -> RecordsAccess -> RecordsResource
  EvaluationEngine -> PoliciesAccess -> PoliciesResource
  ProcessManager -> RecordsAccess -> RecordsResource
}

/* TODO: check */
UseCase "View Referral Progress" {
  AppClient -> ProcessManager
  ProcessManager -> EvaluationEngine
  EvaluationEngine -> AccountsAccess -> AccountsResource
  EvaluationEngine -> RecordsAccess -> RecordsResource
  EvaluationEngine -> PoliciesAccess -> PoliciesResource
  ProcessManager -> RecordsAccess -> RecordsResource
}

/* TODO: check */
UseCase "Edit Referral Requirement Completion" {
  AppClient -> ProcessManager
  ProcessManager -> EvaluationEngine
  EvaluationEngine -> AccountsAccess -> AccountsResource
  EvaluationEngine -> RecordsAccess -> RecordsResource
  EvaluationEngine -> PoliciesAccess -> PoliciesResource
  ProcessManager -> RecordsAccess -> RecordsResource
}

/* TODO: check */
UseCase "Edit Referral Requirement Exemption" {
  AppClient -> ProcessManager
  ProcessManager -> EvaluationEngine
  EvaluationEngine -> AccountsAccess -> AccountsResource
  EvaluationEngine -> RecordsAccess -> RecordsResource
  EvaluationEngine -> PoliciesAccess -> PoliciesResource
  ProcessManager -> RecordsAccess -> RecordsResource
}

/* TODO: check */
UseCase "View Referral History" {
  AppClient -> ProcessManager
  ProcessManager -> EvaluationEngine
  EvaluationEngine -> AccountsAccess -> AccountsResource
  EvaluationEngine -> RecordsAccess -> RecordsResource
  EvaluationEngine -> PoliciesAccess -> PoliciesResource
  ProcessManager -> RecordsAccess -> RecordsResource
}

/* TODO: check */
UseCase "Create Arrangement" {
  AppClient -> ProcessManager
  ProcessManager -> EvaluationEngine
  EvaluationEngine -> AccountsAccess -> AccountsResource
  EvaluationEngine -> RecordsAccess -> RecordsResource
  EvaluationEngine -> PoliciesAccess -> PoliciesResource
  ProcessManager -> RecordsAccess -> RecordsResource
}

/* TODO: check */
UseCase "Edit Arrangement" {
  AppClient -> ProcessManager
  ProcessManager -> EvaluationEngine
  EvaluationEngine -> AccountsAccess -> AccountsResource
  EvaluationEngine -> RecordsAccess -> RecordsResource
  EvaluationEngine -> PoliciesAccess -> PoliciesResource
  ProcessManager -> RecordsAccess -> RecordsResource
}

/* TODO: check */
UseCase "View Assignments" {
  AppClient -> ProcessManager
  ProcessManager -> EvaluationEngine
  EvaluationEngine -> AccountsAccess -> AccountsResource
  EvaluationEngine -> RecordsAccess -> RecordsResource
  EvaluationEngine -> PoliciesAccess -> PoliciesResource
  ProcessManager -> RecordsAccess -> RecordsResource
}

/* TODO: check */
UseCase "Edit Assignments" {
  AppClient -> ProcessManager
  ProcessManager -> EvaluationEngine
  EvaluationEngine -> AccountsAccess -> AccountsResource
  EvaluationEngine -> RecordsAccess -> RecordsResource
  EvaluationEngine -> PoliciesAccess -> PoliciesResource
  ProcessManager -> RecordsAccess -> RecordsResource
}

/* TODO: check */
UseCase "View Arrangement Progress" {
  AppClient -> ProcessManager
  ProcessManager -> EvaluationEngine
  EvaluationEngine -> AccountsAccess -> AccountsResource
  EvaluationEngine -> RecordsAccess -> RecordsResource
  EvaluationEngine -> PoliciesAccess -> PoliciesResource
  ProcessManager -> RecordsAccess -> RecordsResource
}

/* TODO: check */
UseCase "Create Community" {
  AppClient -> ProcessManager
  ProcessManager -> EvaluationEngine
  EvaluationEngine -> AccountsAccess -> AccountsResource
  EvaluationEngine -> RecordsAccess -> RecordsResource
  EvaluationEngine -> PoliciesAccess -> PoliciesResource
  ProcessManager -> RecordsAccess -> RecordsResource
}

/* TODO: check */
UseCase "Edit Community" {
  AppClient -> ProcessManager
  ProcessManager -> EvaluationEngine
  EvaluationEngine -> AccountsAccess -> AccountsResource
  EvaluationEngine -> RecordsAccess -> RecordsResource
  EvaluationEngine -> PoliciesAccess -> PoliciesResource
  ProcessManager -> RecordsAccess -> RecordsResource
}

/* TODO: check */
UseCase "Archive Community" {
  AppClient -> ProcessManager
  ProcessManager -> EvaluationEngine
  EvaluationEngine -> AccountsAccess -> AccountsResource
  EvaluationEngine -> RecordsAccess -> RecordsResource
  EvaluationEngine -> PoliciesAccess -> PoliciesResource
  ProcessManager -> RecordsAccess -> RecordsResource
}

/* TODO: check */
UseCase "Edit Community Member Families" {
  AppClient -> ProcessManager
  ProcessManager -> EvaluationEngine
  EvaluationEngine -> AccountsAccess -> AccountsResource
  EvaluationEngine -> RecordsAccess -> RecordsResource
  EvaluationEngine -> PoliciesAccess -> PoliciesResource
  ProcessManager -> RecordsAccess -> RecordsResource
}

/* TODO: check */
UseCase "Edit Community Role Assignments" {
  AppClient -> ProcessManager
  ProcessManager -> EvaluationEngine
  EvaluationEngine -> AccountsAccess -> AccountsResource
  EvaluationEngine -> RecordsAccess -> RecordsResource
  EvaluationEngine -> PoliciesAccess -> PoliciesResource
  ProcessManager -> RecordsAccess -> RecordsResource
}

/* TODO: check */
UseCase "View Community Document Metadata" {
  AppClient -> ProcessManager
  ProcessManager -> EvaluationEngine
  EvaluationEngine -> AccountsAccess -> AccountsResource
  EvaluationEngine -> RecordsAccess -> RecordsResource
  EvaluationEngine -> PoliciesAccess -> PoliciesResource
  ProcessManager -> RecordsAccess -> RecordsResource
}

/* TODO: check */
UseCase "Read Community Documents (Future)" {
  AppClient -> ProcessManager
  ProcessManager -> EvaluationEngine
  EvaluationEngine -> AccountsAccess -> AccountsResource
  EvaluationEngine -> RecordsAccess -> RecordsResource
  EvaluationEngine -> PoliciesAccess -> PoliciesResource
  ProcessManager -> RecordsAccess -> RecordsResource
}

/* TODO: check */
UseCase "Upload Community Documents" {
  AppClient -> ProcessManager
  ProcessManager -> EvaluationEngine
  EvaluationEngine -> AccountsAccess -> AccountsResource
  EvaluationEngine -> RecordsAccess -> RecordsResource
  EvaluationEngine -> PoliciesAccess -> PoliciesResource
  ProcessManager -> RecordsAccess -> RecordsResource
}

/* TODO: check */
UseCase "Archive Community Documents" {
  AppClient -> ProcessManager
  ProcessManager -> EvaluationEngine
  EvaluationEngine -> AccountsAccess -> AccountsResource
  EvaluationEngine -> RecordsAccess -> RecordsResource
  EvaluationEngine -> PoliciesAccess -> PoliciesResource
  ProcessManager -> RecordsAccess -> RecordsResource
}

/* TODO: check */
UseCase "Open my family screen" {
  AppClient -> ProcessManager
  ProcessManager -> EvaluationEngine
  EvaluationEngine -> AccountsAccess -> AccountsResource
  EvaluationEngine -> RecordsAccess -> RecordsResource
  EvaluationEngine -> PoliciesAccess -> PoliciesResource
  ProcessManager -> RecordsAccess -> RecordsResource
}

/* TODO: check */
UseCase "View all families" {
  AppClient -> ProcessManager
  ProcessManager -> EvaluationEngine
  EvaluationEngine -> AccountsAccess -> AccountsResource
  EvaluationEngine -> RecordsAccess -> RecordsResource
  EvaluationEngine -> PoliciesAccess -> PoliciesResource
  ProcessManager -> RecordsAccess -> RecordsResource
}

/* TODO: check */
UseCase "View soft deleted document" {
  AppClient -> ProcessManager
  ProcessManager -> EvaluationEngine
  EvaluationEngine -> AccountsAccess -> AccountsResource
  EvaluationEngine -> RecordsAccess -> RecordsResource
  EvaluationEngine -> PoliciesAccess -> PoliciesResource
  ProcessManager -> RecordsAccess -> RecordsResource
}

/* TODO: check */
UseCase "Restore a soft deleted document" {
  AppClient -> ProcessManager
  ProcessManager -> EvaluationEngine
  EvaluationEngine -> AccountsAccess -> AccountsResource
  EvaluationEngine -> RecordsAccess -> RecordsResource
  EvaluationEngine -> PoliciesAccess -> PoliciesResource
  ProcessManager -> RecordsAccess -> RecordsResource
}

/* TODO: check */
UseCase "Set document visibility" {
  AppClient -> ProcessManager
  ProcessManager -> EvaluationEngine
  EvaluationEngine -> AccountsAccess -> AccountsResource
  EvaluationEngine -> RecordsAccess -> RecordsResource
  EvaluationEngine -> PoliciesAccess -> PoliciesResource
  ProcessManager -> RecordsAccess -> RecordsResource
}

/* TODO: check */
UseCase "Set note visibility" {
  AppClient -> ProcessManager
  ProcessManager -> EvaluationEngine
  EvaluationEngine -> AccountsAccess -> AccountsResource
  EvaluationEngine -> RecordsAccess -> RecordsResource
  EvaluationEngine -> PoliciesAccess -> PoliciesResource
  ProcessManager -> RecordsAccess -> RecordsResource
}

/* TODO: check */
UseCase "Edit Arrangement Requirement Completion" {
  AppClient -> ProcessManager
  ProcessManager -> EvaluationEngine
  EvaluationEngine -> AccountsAccess -> AccountsResource
  EvaluationEngine -> RecordsAccess -> RecordsResource
  EvaluationEngine -> PoliciesAccess -> PoliciesResource
  ProcessManager -> RecordsAccess -> RecordsResource
}

/* TODO: check */
UseCase "Edit Arrangement Requirement Exemption" {
  AppClient -> ProcessManager
  ProcessManager -> EvaluationEngine
  EvaluationEngine -> AccountsAccess -> AccountsResource
  EvaluationEngine -> RecordsAccess -> RecordsResource
  EvaluationEngine -> PoliciesAccess -> PoliciesResource
  ProcessManager -> RecordsAccess -> RecordsResource
}

/* TODO: check */
UseCase "Delete Arrangement" {
  AppClient -> ProcessManager
  ProcessManager -> EvaluationEngine
  EvaluationEngine -> AccountsAccess -> AccountsResource
  EvaluationEngine -> RecordsAccess -> RecordsResource
  EvaluationEngine -> PoliciesAccess -> PoliciesResource
  ProcessManager -> RecordsAccess -> RecordsResource
}

/* TODO: check */
UseCase "View Child Location History" {
  AppClient -> ProcessManager
  ProcessManager -> EvaluationEngine
  EvaluationEngine -> AccountsAccess -> AccountsResource
  EvaluationEngine -> RecordsAccess -> RecordsResource
  EvaluationEngine -> PoliciesAccess -> PoliciesResource
  ProcessManager -> RecordsAccess -> RecordsResource
}

/* TODO: check */
UseCase "Send Bulk SMS" {
  AppClient -> CommunicationManager
  CommunicationManager -> EvaluationEngine
  EvaluationEngine -> AccountsAccess -> AccountsResource
  EvaluationEngine -> RecordsAccess -> RecordsResource
  EvaluationEngine -> PoliciesAccess -> PoliciesResource
  CommunicationManager -> RecordsAccess -> RecordsResource
  CommunicationManager -> TelephonyUtility
}

/* Referrals/Cases split */

UseCase "View Referrals" {
  AppClient -> ProcessManager
  ProcessManager -> EvaluationEngine
  EvaluationEngine -> AccountsAccess -> AccountsResource
  EvaluationEngine -> RecordsAccess -> RecordsResource
  EvaluationEngine -> PoliciesAccess -> PoliciesResource
  ProcessManager -> RecordsAccess -> RecordsResource
}

UseCase "Create Referral (after split)" {
  AppClient -> ProcessManager
  ProcessManager -> EvaluationEngine
  EvaluationEngine -> AccountsAccess -> AccountsResource
  /* does it need to interact with records and policies access? */
  ProcessManager -> WorkflowsAccess -> WorkflowsResource
  ProcessManager -> RecordsAccess -> RecordsResource
  ProcessManager -:q> CommunicationManager
}

UseCase "Link Referral to Family" {
  AppClient -> ProcessManager
  ProcessManager -> EvaluationEngine
  EvaluationEngine -> AccountsAccess -> AccountsResource
  EvaluationEngine -> RecordsAccess -> RecordsResource
  EvaluationEngine -> PoliciesAccess -> PoliciesResource
  ProcessManager -> WorkflowsAccess -> WorkflowsResource
  ProcessManager -> RecordsAccess -> RecordsResource
  ProcessManager -:q> CommunicationManager
}

UseCase "Unlink Referral from Family " {
  AppClient -> ProcessManager
  ProcessManager -> EvaluationEngine
  EvaluationEngine -> AccountsAccess -> AccountsResource
  EvaluationEngine -> RecordsAccess -> RecordsResource
  EvaluationEngine -> PoliciesAccess -> PoliciesResource
  ProcessManager -> RecordsAccess -> RecordsResource
}

UseCase "Close Referral  (after split)" {
  AppClient -> ProcessManager
  ProcessManager -> EvaluationEngine
  EvaluationEngine -> AccountsAccess -> AccountsResource
  EvaluationEngine -> RecordsAccess -> RecordsResource
  EvaluationEngine -> PoliciesAccess -> PoliciesResource
  ProcessManager -> RecordsAccess -> RecordsResource
}

UseCase "Open Case" {
  AppClient -> ProcessManager
  ProcessManager -> EvaluationEngine
  EvaluationEngine -> AccountsAccess -> AccountsResource
  EvaluationEngine -> RecordsAccess -> RecordsResource
  EvaluationEngine -> PoliciesAccess -> PoliciesResource
  ProcessManager -> WorkflowsAccess -> WorkflowsResource
  ProcessManager -> RecordsAccess -> RecordsResource
  ProcessManager -:q> CommunicationManager
}

UseCase "Link Referral to Case" {
  AppClient -> ProcessManager
  ProcessManager -> EvaluationEngine
  EvaluationEngine -> AccountsAccess -> AccountsResource
  EvaluationEngine -> RecordsAccess -> RecordsResource
  EvaluationEngine -> PoliciesAccess -> PoliciesResource
  ProcessManager -> RecordsAccess -> RecordsResource
}

UseCase "Unlink Referral from Case" {
  AppClient -> ProcessManager
  ProcessManager -> EvaluationEngine
  EvaluationEngine -> AccountsAccess -> AccountsResource
  EvaluationEngine -> RecordsAccess -> RecordsResource
  EvaluationEngine -> PoliciesAccess -> PoliciesResource
  ProcessManager -> RecordsAccess -> RecordsResource
}

UseCase "Close Case" {
  AppClient -> ProcessManager
  ProcessManager -> EvaluationEngine
  EvaluationEngine -> AccountsAccess -> AccountsResource
  EvaluationEngine -> RecordsAccess -> RecordsResource
  EvaluationEngine -> PoliciesAccess -> PoliciesResource
  ProcessManager -> RecordsAccess -> RecordsResource
}